import{a as fe}from"./chunk-R2MSFRTF.js";import{a as ge}from"./chunk-LZ6H3AFR.js";import{b as H}from"./chunk-VNFDGEEB.js";import{a as J}from"./chunk-BYI4GQNY.js";import{a as j}from"./chunk-BBNXGYOG.js";import{b as te,c as ie,d as ne,e as ae,f as re,g as oe,h as se,i as le,j as me,k as ce,l as de,m as pe,n as _e,o as ue}from"./chunk-N4EAPRBL.js";import{j as $}from"./chunk-JNRCB37G.js";import{v as B,w as G}from"./chunk-HM5AIPJZ.js";import{a as C}from"./chunk-GMUQQUFC.js";import{n as Q,p as X,q as Y,r as K,s as ee}from"./chunk-YL2U7DAQ.js";import{T as P,U as F,V as N,pa as A,ra as O,sa as q,ua as W}from"./chunk-UA7J2MJT.js";import"./chunk-IUWJHV3G.js";import{Ja as p,La as m,Nb as R,Ob as L,Sa as b,Wa as r,Xa as o,Y as Z,Ya as _,Za as v,_a as x,ab as w,ca as u,cc as V,d as k,da as f,db as g,ec as y,fb as d,mb as T,nb as c,ob as S,pb as z,sb as M,ua as l,ub as E,va as h,zb as D}from"./chunk-UIBI7PPD.js";var I=function(e){return e.PENDING="pending",e.IN_PROGRESS="in_progress",e.COMPLETED="completed",e.FAILED="failed",e.CANCELLED="cancelled",e.UNKNOWN="unknown",e}(I||{});var Se=e=>({"sm:mb-18":e}),be=e=>({"pointer-events-none":e});function Ie(e,a){e&1&&_(0,"mat-progress-spinner",17),e&2&&m("diameter",24)("mode","indeterminate")}function Ue(e,a){e&1&&(r(0,"span"),c(1,"Import Zitadel Users"),o())}function Ee(e,a){if(e&1){let i=w();r(0,"button",15),g("click",function(){u(i);let n=d();return f(n.viewTaskStatus())}),r(1,"span"),c(2,"View Task History"),o()(),r(3,"button",16),g("click",function(){u(i);let n=d();return f(n.importZitadelUser())}),p(4,Ie,1,2,"mat-progress-spinner",17)(5,Ue,2,0,"span"),o()}if(e&2){let i=d();l(3),m("color","primary")("disabled",i.isImportLoading),l(),b(i.isImportLoading?4:5)}}function ye(e,a){if(e&1){let i=w();r(0,"button",18),g("click",function(){u(i);let n=d();return f(n.clearSearch())}),_(1,"mat-icon",19),r(2,"span"),c(3,"Clear Filter"),o()()}e&2&&(m("color","primary"),l(),m("svgIcon","heroicons_outline:x-mark"))}function ke(e,a){if(e&1&&(r(0,"fuse-alert",20),c(1),o()),e&2){let i=d();m("appearance","outline")("showIcon",!1)("type",i.alert.type)("@shake",i.alert.type==="error"),l(),z(" ",i.alert.message," ")}}function Ze(e,a){e&1&&(r(0,"th",32),c(1," Name"),o())}function Te(e,a){if(e&1&&(r(0,"td",33),c(1),o()),e&2){let i=a.$implicit;l(),S(i.name)}}function ze(e,a){e&1&&(r(0,"th",32),c(1," Email"),o())}function Me(e,a){if(e&1&&(r(0,"td",33),c(1),o()),e&2){let i=a.$implicit;l(),S(i.email||"-")}}function De(e,a){e&1&&(r(0,"th",32),c(1," Zitadel User Id"),o())}function Re(e,a){if(e&1&&(r(0,"td",33),c(1),o()),e&2){let i=a.$implicit;l(),S(i.zitadel_user_id||"-")}}function Le(e,a){e&1&&(r(0,"th",32),c(1," Tenant"),o())}function Ve(e,a){if(e&1&&(r(0,"td",33),c(1),o()),e&2){let i=a.$implicit;l(),S(i.tenant.name||"-")}}function Pe(e,a){e&1&&(r(0,"th",32),c(1," Action"),o())}function Fe(e,a){if(e&1){let i=w();r(0,"td",33)(1,"button",34),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.viewDevice(n.id))}),_(2,"mat-icon",19),o(),r(3,"button",35),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.viewDeviceUser(n.id))}),_(4,"mat-icon",19),o(),r(5,"button",36),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.viewSharedUser(n.id))}),_(6,"mat-icon",19),o(),r(7,"button",37),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.viewDeviceLogs(n.id))}),_(8,"mat-icon",19),o(),r(9,"button",38),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.viewAdminLogs(n.id))}),_(10,"mat-icon",19),o(),r(11,"button",39),g("click",function(){let n=u(i).$implicit,s=d(2);return f(s.deleteConfirmation(n))}),_(12,"mat-icon",40),o()()}e&2&&(l(2),m("svgIcon","heroicons_outline:computer-desktop"),l(2),m("svgIcon","mat_outline:devices"),l(2),m("svgIcon","mat_outline:screen_share"),l(2),m("svgIcon","mat_outline:screen_search_desktop"),l(2),m("svgIcon","mat_outline:manage_search"),l(2),m("svgIcon","heroicons_outline:trash"))}function Ne(e,a){e&1&&_(0,"tr",41)}function He(e,a){e&1&&_(0,"tr",42)}function Ae(e,a){if(e&1){let i=w();v(0),r(1,"table",21),v(2,22),p(3,Ze,2,0,"th",23)(4,Te,2,1,"td",24),x(),v(5,25),p(6,ze,2,0,"th",23)(7,Me,2,1,"td",24),x(),v(8,26),p(9,De,2,0,"th",23)(10,Re,2,1,"td",24),x(),v(11,27),p(12,Le,2,0,"th",23)(13,Ve,2,1,"td",24),x(),v(14,28),p(15,Pe,2,0,"th",23)(16,Fe,13,6,"td",24),x(),p(17,Ne,1,0,"tr",29)(18,He,1,0,"tr",30),o(),r(19,"mat-paginator",31),g("page",function(n){u(i);let s=d();return f(s.handlePageEvent(n))}),o(),x()}if(e&2){let i=d();l(),m("dataSource",i.zitadelUsers),l(16),m("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",i.displayedColumns),l(),m("ngClass",E(10,be,i.isLoading))("length",i.pagination.length)("pageIndex",i.pagination.page)("pageSize",i.pagination.size)("pageSizeOptions",i.pageSize)("showFirstLastButtons",!0)}}function Oe(e,a){e&1&&(r(0,"div",44),c(1," There are no users! "),o())}function qe(e,a){if(e&1&&p(0,Oe,2,0,"div",43),e&2){let i=d();m("ngIf",!i.isLoading)}}function $e(e,a){e&1&&(v(0),r(1,"div",45),_(2,"mat-progress-spinner",46),r(3,"h4",47),c(4,"Fetching your zitadel users..."),o()(),x())}var he=(()=>{let a=class a{constructor(t,n,s,U,ve,xe,Ce,we){this._snackBar=t,this._activatedRoute=n,this._fuseConfirmationService=s,this._router=U,this._zitadelUsersService=ve,this._taskStatusService=xe,this.router=Ce,this._userService=we,this._subscription=new k,this.displayedColumns=["name","email","zitadel_user_id","tenant_id","action"],this.pageSize=ue,this.userRole=J,this.pagination={length:0,page:0,size:this.pageSize[0]},this.alert={type:"success",message:""},this.showAlert=!1,this.isLoading=!1,this.isImportLoading=!1}ngOnInit(){this.pagination.tenant_id=this._activatedRoute.snapshot.queryParamMap.get("tenant_id"),this.pagination.page=Number(this._activatedRoute.snapshot.queryParamMap.get("page")??0),this.pagination.size=Number(this._activatedRoute.snapshot.queryParamMap.get("size")??this.pageSize[0]),this.isLoading=!0,this._subscription.add(this._userService.user$.subscribe(t=>{this.user=t})),this.getZitadelUsers()}getZitadelUsers(){this.isLoading=!0,this.queryParamHandler(),this._subscription.add(this._zitadelUsersService.getZitadelUsers(this.pagination).subscribe({next:t=>{this.zitadelUsers=t.items,this.pagination.length=t.total,this.isLoading=!1},error:t=>{t.status!==404&&this.onFailed(t.status===500?"500: Internal Server Error":t.error.detail),this.isLoading=!1}}))}clearSearch(){this.pagination.page=0,this.pagination.length=0,this.pagination.tenant_id=void 0,this.getZitadelUsers()}queryParamHandler(){this._router.navigate(["."],{relativeTo:this._activatedRoute,queryParams:{tenant_id:this.pagination.tenant_id,page:this.pagination.page,size:this.pagination.size}}).then()}handlePageEvent(t){this.pagination.length=t.length,this.pagination.size=t.pageSize,this.pagination.page=t.pageIndex,this.getZitadelUsers()}deleteConfirmation(t){this._subscription.add(this._fuseConfirmationService.open({title:"Remove this user",message:"This will remove the user from the shared devices as well as from any device users owned by the user.",icon:{show:!0,name:"heroicons_outline:exclamation-triangle",color:"warn"},actions:{confirm:{show:!0,label:"Remove",color:"warn"},cancel:{show:!0,label:"Cancel"}},dismissible:!0}).afterClosed().subscribe(n=>{n==="confirmed"&&this.deleteZitadelUser(t)}))}deleteZitadelUser(t){this.isLoading=!0,this.showAlert=!1,this._subscription.add(this._zitadelUsersService.deleteZitadelUser(t.id).subscribe({next:()=>this.getZitadelUsers(),error:n=>this.onFailed(n.status===500?"500: Internal Server Error":n.error)}))}importZitadelUser(){this.isImportLoading=!0,this._subscription.add(this._taskStatusService.importZitadelUser().subscribe({next:t=>{this._snackBar.open("Zitadel User Import task started!"),this.alert={type:"info",message:t.message},this.showAlert=!!t.message,this.intervalId=setInterval(()=>{this.checkTaskStatus(t)},5e3)},error:t=>{t.status,this.isImportLoading=!1}}))}checkTaskStatus(t){this._subscription.add(this._taskStatusService.getTaskStatus(t.id).subscribe({next:n=>{this.alert={type:"info",message:n.message},this.showAlert=!!n.message,n.status!==I.IN_PROGRESS&&n.status!==I.PENDING&&(clearInterval(this.intervalId),this.getZitadelUsers(),this.isImportLoading=!1)}}))}viewDevice(t){this.router.navigate([C.DEVICES],{queryParams:{zitadel_user_id:t}}).then()}viewDeviceUser(t){this.router.navigate([C.DEVICE_USERS],{queryParams:{zitadel_user_id:t}}).then()}viewSharedUser(t){this.router.navigate([C.SHARED_USERS],{queryParams:{zitadel_user_id:t}}).then()}viewDeviceLogs(t){this.router.navigate([C.DEVICE_LOGS],{queryParams:{zitadel_user_id:t}}).then()}viewAdminLogs(t){this.router.navigate([C.PORTAL_LOGS],{queryParams:{zitadel_user_id:t}}).then()}viewTaskStatus(){this.router.navigate([C.TASK_STATUS]).then()}onFailed(t){this.alert={type:"error",message:t},this.showAlert=!0,this.isLoading=!1}ngOnDestroy(){this._subscription?.unsubscribe(),this.intervalId&&clearInterval(this.intervalId)}};a.\u0275fac=function(n){return new(n||a)(h(H),h(V),h($),h(y),h(fe),h(ge),h(y),h(j))},a.\u0275cmp=Z({type:a,selectors:[["app-zitadel-users"]],standalone:!0,features:[M],decls:18,vars:9,consts:[["noClients",""],[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"border-b"],[1,"flex","flex-col","w-full","px-6"],[1,"flex","flex-col","sm:flex-row","flex-auto","sm:items-center","min-w-0","my-8"],[1,"flex","flex-auto","items-center","min-w-0"],[1,"flex","flex-col","min-w-0","ml-4"],["id","Clients",1,"text-2xl","md:text-5xl","font-semibold","tracking-tight","leading-7","md:leading-snug","truncate"],[1,"flex","items-center","mt-6","sm:mt-0","sm:ml-2","space-x-3"],["mat-stroked-button","",3,"color"],["class","mb-6",3,"appearance","showIcon","type",4,"ngIf"],[1,"relative","flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-hidden","sm:overflow-y-auto",3,"ngClass"],[4,"ngIf","ngIfElse"],[4,"ngIf"],["mat-flat-button","",3,"click"],["mat-flat-button","",3,"click","color","disabled"],[3,"diameter","mode"],["mat-stroked-button","",3,"click","color"],[1,"icon-size-5",3,"svgIcon"],[1,"mb-6",3,"appearance","showIcon","type"],["mat-table","",1,"w-full",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","zitadel_user_id"],["matColumnDef","tenant_id"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"page","ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","matTooltip","view devices",3,"click"],["mat-icon-button","","matTooltip","view device users",3,"click"],["mat-icon-button","","matTooltip","view shared users",3,"click"],["mat-icon-button","","matTooltip","view device logs",3,"click"],["mat-icon-button","","matTooltip","view portal logs",3,"click"],["mat-icon-button","","matTooltip","delete",3,"click"],[1,"icon-size-5","text-red-500",3,"svgIcon"],["mat-header-row",""],["mat-row",""],["class","p-8 sm:p-16 text-4xl font-semibold tracking-tight text-center",4,"ngIf"],[1,"p-8","sm:p-16","text-4xl","font-semibold","tracking-tight","text-center"],[1,"w-full","h-full","flex","flex-col","justify-center","items-center","bg-default"],["color","primary","diameter","50","strokeWidth","5","mode","indeterminate"],[1,"mt-16"]],template:function(n,s){if(n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7),c(7," Zitadel Users "),o()()(),r(8,"div",8),p(9,Ee,6,3)(10,ye,4,2,"button",9),o()(),p(11,ke,2,5,"fuse-alert",10),o()(),r(12,"div",11)(13,"div",12),p(14,Ae,20,12,"ng-container",13)(15,qe,1,1,"ng-template",null,0,D)(17,$e,5,0,"ng-container",14),o()()()),n&2){let U=T(16);l(9),b((s.user==null?null:s.user.role)===s.userRole.ADMIN?9:-1),l(),b(s.pagination.tenant_id?10:-1),l(),m("ngIf",!s.isLoading&&s.showAlert),l(2),m("ngClass",E(7,Se,(s.zitadelUsers==null?null:s.zitadelUsers.length)>0)),l(),m("ngIf",(s.zitadelUsers==null?null:s.zitadelUsers.length)>0)("ngIfElse",U),l(3),m("ngIf",s.isLoading&&!s.zitadelUsers)}},dependencies:[ee,A,q,O,X,ie,te,K,Y,G,B,L,Q,N,P,F,R,_e,ne,re,me,oe,ae,ce,se,le,de,pe],data:{animation:W}});let e=a;return e})();var yt=[{path:"",component:he}];export{yt as default};

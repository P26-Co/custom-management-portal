import{a as f}from"./chunk-BBNXGYOG.js";import{a as g}from"./chunk-IUWJHV3G.js";import{J as h,P as l,T as u,Xb as p,m as s,n as d}from"./chunk-UIBI7PPD.js";var n=class{static isTokenExpired(e,r){if(!e||e==="")return!0;let t=this._getTokenExpirationDate(e);return r=r||0,t===null?!0:!(t.valueOf()>new Date().valueOf()+r*1e3)}static _b64decode(e){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let o=0,c,a,m=0;a=e.charAt(m++);~a&&(c=o%4?c*64+a:a,o++%4)?t+=String.fromCharCode(255&c>>(-2*o&6)):0)a=r.indexOf(a);return t}static _b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this._b64decode(e),r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join(""))}static _urlBase64Decode(e){let r=e.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:{r+="==";break}case 3:{r+="=";break}default:throw Error("Illegal base64url string!")}return this._b64DecodeUnicode(r)}static _decodeToken(e){if(!e)return null;let r=e.split(".");if(r.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let t=this._urlBase64Decode(r[1]);if(!t)throw new Error("Cannot decode the token.");return JSON.parse(t)}static _getTokenExpirationDate(e){let r=this._decodeToken(e);if(!r.hasOwnProperty("exp"))return null;let t=new Date(0);return t.setUTCSeconds(r.exp),t}};var S=(()=>{let e=class e{constructor(){this._authenticated=!1,this._httpClient=u(p),this._userService=u(f)}set accessToken(t){localStorage.setItem("accessToken",t)}get accessToken(){return localStorage.getItem("accessToken")??""}forgotPassword(t){return this._httpClient.post("api/auth/forgot-password",t)}resetPassword(t){return this._httpClient.post("api/auth/reset-password",t)}signIn(t){return this._authenticated?d("User is already logged in."):this._httpClient.post(g.SIGN_IN,t).pipe(h(o=>(this.accessToken=o.token,this._authenticated=!0,this._userService.user=o.user,s(o))))}signOut(){return localStorage.removeItem("accessToken"),this._authenticated=!1,s(!0)}check(){return this._authenticated?s(!0):this.accessToken?n.isTokenExpired(this.accessToken)?s(!1):s(!0):s(!1)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=l({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();export{n as a,S as b};
